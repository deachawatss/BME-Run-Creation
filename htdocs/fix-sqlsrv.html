<!DOCTYPE html>
<html>
<head>
    <title>SQLSRV Extension Fix Guide</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .container { max-width: 1000px; margin: 0 auto; }
        .step { background: #f8f9fa; padding: 15px; margin: 15px 0; border-radius: 5px; border-left: 4px solid #007bff; }
        .success { border-left-color: #28a745; background: #d4edda; }
        .warning { border-left-color: #ffc107; background: #fff3cd; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .cmd { background: #2d3748; color: #e2e8f0; padding: 15px; border-radius: 5px; font-family: 'Courier New', monospace; margin: 10px 0; }
        .btn { display: inline-block; padding: 10px 20px; background: #007bff; color: white; text-decoration: none; border-radius: 4px; margin: 5px 0; }
        .btn:hover { background: #0056b3; }
        pre { background: #e9ecef; padding: 10px; border-radius: 4px; overflow-x: auto; }
        h2 { color: #495057; border-bottom: 2px solid #dee2e6; padding-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß SQLSRV Extension Fix Guide</h1>
        <p><strong>Issue:</strong> <code>Call to undefined function sqlsrv_configure()</code></p>

        <div class="step">
            <h2>üìã Step 1: Check Current Status</h2>
            <p>First, let's diagnose what's happening:</p>
            <a href="/check-extensions.php" class="btn">üîç Run Extension Diagnostic</a>
            <p>This will show you exactly what's wrong with the SQLSRV extensions.</p>
        </div>

        <div class="step">
            <h2>üöÄ Step 2: Restart Apache</h2>
            <p>After the latest changes, restart Apache to reload PHP configuration:</p>
            <div class="cmd">
                C:\webserver\Apache2\bin\httpd.exe -k stop<br>
                timeout /t 3<br>
                C:\webserver\Apache2\bin\httpd.exe -k start
            </div>
            <p>Then test: <a href="/check-extensions.php" class="btn">üîÑ Check Again</a></p>
        </div>

        <div class="step warning">
            <h2>‚ö†Ô∏è Step 3: If SQLSRV Still Not Working</h2>
            <p>If the extensions still don't load after restart, try this advanced fix:</p>
            
            <h3>Option 3A: Manual Extension Installation</h3>
            <ol>
                <li>Download latest extensions directly from Microsoft:</li>
                <div class="cmd">
                    # Visit: https://github.com/microsoft/msphpsql/releases/latest<br>
                    # Download the Windows DLL files for PHP 8.3<br>
                    # Replace files in: C:\webserver\php\ext\
                </div>
                
                <li>Check Windows Event Viewer for DLL loading errors:</li>
                <div class="cmd">
                    # Press Win+R, type: eventvwr.msc<br>
                    # Go to: Windows Logs ‚Üí Application<br>
                    # Look for PHP or Apache errors
                </div>
            </ol>

            <h3>Option 3B: Verify Dependencies</h3>
            <p>Even though you installed them, verify these are properly installed:</p>
            <ul>
                <li><strong>Visual C++ Redistributable 2019 x64</strong> - Check in Control Panel</li>
                <li><strong>Microsoft ODBC Driver 18</strong> - Check in ODBC Data Sources (64-bit)</li>
            </ul>
        </div>

        <div class="step error">
            <h2>üîÑ Step 4: MySQL Fallback (Temporary Solution)</h2>
            <p>If SQLSRV still won't work, use MySQL temporarily while we fix it:</p>
            
            <h3>Quick MySQL Setup:</h3>
            <div class="cmd">
                # Copy MySQL configuration<br>
                copy C:\webserver\htdocs\bme4\.env.mysql-ready C:\webserver\htdocs\bme4\.env<br>
                <br>
                # Restart Apache<br>
                C:\webserver\Apache2\bin\httpd.exe -k restart
            </div>
            
            <div class="warning">
                <strong>‚ö†Ô∏è Important:</strong> MySQL fallback requires MySQL/MariaDB to be installed on your server. 
                If you don't have MySQL installed, we need to focus on fixing SQLSRV instead.
            </div>
        </div>

        <div class="step success">
            <h2>‚úÖ Step 5: Verify Working</h2>
            <p>After any fix, test these URLs:</p>
            <ul>
                <li><a href="/check-extensions.php">üîç Extension Status</a> - Should show SQLSRV loaded</li>
                <li><a href="/phpinfo.php">üìä PHP Info</a> - Should list SQLSRV in extensions</li>
                <li><a href="/bme4/public/">üéØ BME4 App</a> - Should load without database errors</li>
            </ul>
        </div>

        <div class="step">
            <h2>üÜò Step 6: If Nothing Works</h2>
            <p>If SQLSRV extensions absolutely won't load:</p>
            
            <h3>Alternative Solutions:</h3>
            <ol>
                <li><strong>Use ODBC Driver directly</strong> - Modify BME4 to use ODBC instead of SQLSRV</li>
                <li><strong>Different PHP Version</strong> - Try PHP 8.2 or 8.1 with working SQLSRV extensions</li>
                <li><strong>Different Server Setup</strong> - Consider using a different WAMP/XAMPP stack</li>
            </ol>

            <p><strong>Debug Information to Collect:</strong></p>
            <ul>
                <li>Windows version: <code>winver</code></li>
                <li>Installed VC++ versions: Control Panel ‚Üí Programs</li>
                <li>ODBC drivers: <code>odbcad32.exe</code> (64-bit)</li>
                <li>Windows Event Viewer errors</li>
                <li>Apache error logs: <code>C:\webserver\Apache2\logs\error.log</code></li>
            </ul>
        </div>

        <div class="step">
            <h2>üîó Quick Links</h2>
            <a href="/" class="btn">üè† Dashboard</a>
            <a href="/check-extensions.php" class="btn">üîç Extension Check</a>
            <a href="/phpinfo.php" class="btn">üìä PHP Info</a>
            <a href="/bme4/public/" class="btn">üéØ BME4 App</a>
        </div>

        <div class="step">
            <h2>üìû Support Information</h2>
            <p><strong>What to report if you need help:</strong></p>
            <ol>
                <li>Output from: <a href="/check-extensions.php">Extension Diagnostic</a></li>
                <li>Windows version and architecture</li>
                <li>Any error messages from Windows Event Viewer</li>
                <li>Apache error log entries (last 20 lines)</li>
            </ol>
        </div>
    </div>
</body>
</html>