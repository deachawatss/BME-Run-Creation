# BME4 Production Virtual Host Configuration
# CodeIgniter 4 Application Setup

<VirtualHost *:80>
    # Server configuration
    ServerName bme4.local
    ServerAlias www.bme4.local
    
    # Document root points to CodeIgniter 4 public directory
    DocumentRoot "C:/webserver/htdocs/bme4/public"
    
    # Directory permissions for CI4 public folder
    <Directory "C:/webserver/htdocs/bme4/public">
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Enable .htaccess for CI4 routing
        <IfModule mod_rewrite.c>
            RewriteEngine On
            RewriteBase /
        </IfModule>
    </Directory>
    
    # Protect application directories from web access
    <Directory "C:/webserver/htdocs/bme4/app">
        Require all denied
    </Directory>
    
    <Directory "C:/webserver/htdocs/bme4/system">
        Require all denied
    </Directory>
    
    <Directory "C:/webserver/htdocs/bme4/writable">
        Require all denied
    </Directory>
    
    # PHP configuration
    <FilesMatch "\.php$">
        SetHandler application/x-httpd-php
    </FilesMatch>
    
    # Security headers
    <IfModule mod_headers.c>
        Header always set X-Content-Type-Options "nosniff"
        Header always set X-Frame-Options "SAMEORIGIN"
        Header always set X-XSS-Protection "1; mode=block"
        Header always set Referrer-Policy "strict-origin-when-cross-origin"
    </IfModule>
    
    # Logging
    ErrorLog "logs/bme4_error.log"
    CustomLog "logs/bme4_access.log" combined
    
    # Log level for debugging
    LogLevel warn
    
</VirtualHost>

# Optional: HTTPS Virtual Host (uncomment when SSL is configured)
# <VirtualHost *:443>
#     ServerName bme4.local
#     ServerAlias www.bme4.local
#     
#     DocumentRoot "C:/webserver/htdocs/bme4/public"
#     
#     # SSL Configuration
#     SSLEngine on
#     SSLCertificateFile "conf/ssl/bme4.crt"
#     SSLCertificateKeyFile "conf/ssl/bme4.key"
#     
#     # Same directory and security settings as HTTP
#     <Directory "C:/webserver/htdocs/bme4/public">
#         Options -Indexes +FollowSymLinks
#         AllowOverride All
#         Require all granted
#     </Directory>
#     
#     # Protect application directories
#     <Directory "C:/webserver/htdocs/bme4/app">
#         Require all denied
#     </Directory>
#     
#     <Directory "C:/webserver/htdocs/bme4/system">
#         Require all denied
#     </Directory>
#     
#     <Directory "C:/webserver/htdocs/bme4/writable">
#         Require all denied
#     </Directory>
#     
#     # Security headers for HTTPS
#     <IfModule mod_headers.c>
#         Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
#         Header always set X-Content-Type-Options "nosniff"
#         Header always set X-Frame-Options "SAMEORIGIN"
#         Header always set X-XSS-Protection "1; mode=block"
#         Header always set Referrer-Policy "strict-origin-when-cross-origin"
#     </IfModule>
#     
#     # HTTPS Logging
#     ErrorLog "logs/bme4_ssl_error.log"
#     CustomLog "logs/bme4_ssl_access.log" combined
# </VirtualHost>